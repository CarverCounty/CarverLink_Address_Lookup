<!-- https://community.esri.com/t5/calcite-design-system-questions/populate-combobox-from-a-local-json-array-file/td-p/1161016 -->

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>CarverLink!!</title>
	<!-- <script id ="addyList" src="addy.csv"></script> -->
    <script src="https://js.arcgis.com/calcite-components/1.4.2/calcite.esm.js" type="module"></script>
    <link rel="stylesheet" href="https://js.arcgis.com/calcite-components/1.4.2/calcite.css" />

    <script src="https://js.arcgis.com/4.26/"></script>
    <link rel="stylesheet" href="https://js.arcgis.com/4.26/esri/themes/light/main.css" />
  </head>
  <style>
    html,
    body,
    #viewDiv {
      padding: 0px;
      margin: 0;
      height: 100%;
      width: 100%;
    }
  </style>
  <body> 


	<calcite-shell content-behind >
	<calcite-filter placeholder="Type Your Address!!!"></calcite-filter>
	
	        <calcite-notice id="note">

          <div id="number-records" slot="title">
            <!-- Content is automatically generated -->
          </div>

        </calcite-notice>
		
  <!-- <calcite-combobox id="address-select" placeholder="Enter An Address!" selection-mode="single" on> -->
    <!-- <calcite-combobox-item value="Natural Resources" text-label="Natural Resources"></calcite-combobox-item> -->
    <!-- <calcite-combobox-item value="Agriculture" text-label="Agriculture"></calcite-combobox-item> -->
    <!-- <calcite-combobox-item value="Forestry" text-label="Forestry"></calcite-combobox-item> -->
    <!-- <calcite-combobox-item value="Mining" text-label="Mining"></calcite-combobox-item> -->
    <!-- <calcite-combobox-item value="Business" text-label="Business"></calcite-combobox-item> -->
    <!-- <calcite-combobox-item value="Education" text-label="Education"></calcite-combobox-item> -->
    <!-- <calcite-combobox-item value="Utilities" text-label="Utilities"></calcite-combobox-item> -->
    <!-- <calcite-combobox-item value="Transportation" text-label="Transportation"></calcite-combobox-item> -->
<!-- </calcite-combobox> -->

		<calcite-shell-panel slot="panel-start" display-mode="float">
		</calcite-shell-panel>
		<div id="viewDiv"></div>
	</calcite-shell>
  </body>
  
  <script>
	const filterElement = document.querySelector("calcite-filter");
	const noticeElement = document.querySelector("calcite-notice");
	//fetch("https://services9.arcgis.com/RHVPKKiFTONKtxq3/ArcGIS/rest/services/USGS_Seismic_Data_v1/FeatureServer/0/query?where=1%3D1&outFields=*&f=json")
  fetch("https://services.arcgis.com/wMZT8kNwa6tOxhKg/ArcGIS/rest/services/Onion_Test/FeatureServer/0/query?where=1%3D1&outFields=*&f=json")
  .then((response) => response.json())
  .then(({features}) => features.map(({attributes}) => attributes))

  .then((attributes) => initFilter(attributes));
 
  /* Filter the results to display */
  const initFilter = (items) => {
    filterElement.items = items;

    document.addEventListener("calciteFilterChange", () => {
	noticeElement.open = false;
      <!-- paginationElement.startItem = 1; -->
      <!-- paginationElement.totalItems = 0; -->

      <!-- // Prevent display of elements if no Filter value is present -->
      <!-- noticeElement.open = false; -->

      <!-- paginationElement.style.visibility = "hidden"; -->

      //cardContainer.innerHTML = "";

      // When a Filter value is present
      // Create Cards, update Pagination, and number of responses
      if (filterElement.value) {

        filterElement.filteredItems.forEach((item) => createCard(item));
        paginationElement.totalItems = filterElement.filteredItems.length;

        showNumberOfResponses(filterElement.filteredItems.length);

        // If additional pages are populated, display Pagination
        if (paginationElement.totalItems > paginationElement.pageSize) {
          paginationElement.style.visibility = "visible";
        }

      }
    });

  };
  
  const createCard = (item) => {
  console.log(item);
  }
  </script>
  <script>
    require([
      "esri/WebMap",
      "esri/views/MapView",
	  "esri/config"		  
    ], function(WebMap, MapView, esriConfig ) {
		<!-- esriConfig.apiKey = "YOUR_API_KEY"; -->
      const webmapId = new URLSearchParams(window.location.search).get("webmap")
        ?? "8f67432164eb4dcba08eef1d01dbbad7";

      const map = new WebMap({
        portalItem: {
          id: webmapId
        }
      });

	  const view = new MapView({
        map,
        container: "viewDiv",
        padding: {
          left: 49
        }
      });

	  view.when().then(function () { 
		  classSelect = document.getElementById("address-select");
		  console.log(classSelect);
		  classSelect.addEventListener("change", comboBoxSelectionChange);
		  classSelect.addEventListener("change", comboBoxSelectionChange);
		  console.log("AAA6");	  
	  }); 
	  function comboBoxSelectionChange() {              
          const fieldLabel = classSelect.selectedItems[0].innerText;
          console.info("change: ", fieldLabel)
	  }
	  function comboBoxFilerChange() {              
          const fieldLabel = classSelect.selectedItems[0].innerText;
          console.info("change: ", fieldLabel)
	  }

    });
  </script>
  
  <script>
  window.addEventListener('load', () => {
    const testComboBox = document.getElementById('address-select');     
    testComboBox.addEventListener("calciteComboboxChange", calciteComboboxChangeEvt => {
	var theAddress = document.getElementById('address-select').value;
	console.log(theAddress);
	if (theAddress == "Mining"){
		document.getElementById('viewDiv').style.visibility = 'hidden'
	} else {
		document.getElementById('viewDiv').style.visibility = 'visible'
	}
    });     
    
  }, false);
</script>

  <script>
    var file = new XMLHttpRequest();	
	
	function populateList(inText){
		const combobox = document.getElementById("address-select");
		var rows = inText.split(/\n/);
		for (var rowIndex = 0; rowIndex < rows.length; ++rowIndex){
			<!-- var iRow = rows[rowIndex]; -->
			<!-- const item = document.createElement("calcite-combobox-item"); -->
			<!-- item.value = iRow.split(",")[0]; -->
			<!-- item.textLabel = iRow.split(",")[0]; -->
			
			<!-- combobox.appendChild(item); -->
  
		}
	}
    file.onreadystatechange = function() {console.log("b1");console.log(file.readyState);
      if (file.readyState === 4) {  console.log("b2");// Makes sure the document is ready to parse
        if (file.status === 200) { console.log("b3"); // Makes sure it's found the file
          var text = file.responseText;console.log("b4");
		  populateList(text);
        }
      } else {
		
	  }
    }
	console.log("A2");
	file.open("GET", "https://gis.co.carver.mn.us/embedded_apps/carverlink/addy.csv", true);
	file.send()
	console.log("A3");
</script>
</html>